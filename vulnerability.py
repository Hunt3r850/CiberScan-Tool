"""
Clase Vulnerability para representar una vulnerabilidad detectada.

Esta clase almacena información sobre una vulnerabilidad, incluyendo su
identificador, descripción, nivel de riesgo y posibles mitigaciones.
"""

class Vulnerability:
    def __init__(self, vuln_id, name, description=None, cvss_score=None):
        """
        Inicializa un nuevo objeto Vulnerability.
        
        Args:
            vuln_id (str): Identificador único de la vulnerabilidad (ej. CVE-2021-1234)
            name (str): Nombre descriptivo de la vulnerabilidad
            description (str, opcional): Descripción detallada de la vulnerabilidad
            cvss_score (float, opcional): Puntuación CVSS (Common Vulnerability Scoring System)
        """
        self.vuln_id = vuln_id
        self.name = name
        self.description = description
        self.cvss_score = cvss_score
        self.affected_systems = []
        self.references = []
        self.mitigation = None
        self.detection_date = None
        self.severity = self._calculate_severity()
        
    def _calculate_severity(self):
        """
        Calcula la severidad basada en la puntuación CVSS.
        
        Returns:
            str: Nivel de severidad (Critical, High, Medium, Low, None)
        """
        if self.cvss_score is None:
            return "Unknown"
        elif self.cvss_score >= 9.0:
            return "Critical"
        elif self.cvss_score >= 7.0:
            return "High"
        elif self.cvss_score >= 4.0:
            return "Medium"
        elif self.cvss_score > 0:
            return "Low"
        else:
            return "None"
            
    def add_affected_system(self, system):
        """
        Añade un sistema afectado por esta vulnerabilidad.
        
        Args:
            system (dict): Información del sistema afectado
        """
        self.affected_systems.append(system)
        
    def add_reference(self, reference):
        """
        Añade una referencia relacionada con esta vulnerabilidad.
        
        Args:
            reference (str): URL o identificador de la referencia
        """
        self.references.append(reference)
        
    def set_mitigation(self, mitigation):
        """
        Establece la información de mitigación para esta vulnerabilidad.
        
        Args:
            mitigation (str): Descripción de cómo mitigar la vulnerabilidad
        """
        self.mitigation = mitigation
        
    def to_dict(self):
        """
        Convierte el objeto Vulnerability a un diccionario.
        
        Returns:
            dict: Representación de la vulnerabilidad como diccionario
        """
        return {
            'vuln_id': self.vuln_id,
            'name': self.name,
            'description': self.description,
            'cvss_score': self.cvss_score,
            'severity': self.severity,
            'affected_systems': self.affected_systems,
            'references': self.references,
            'mitigation': self.mitigation,
            'detection_date': self.detection_date
        }
    
    def __str__(self):
        """
        Representación en cadena de la vulnerabilidad.
        
        Returns:
            str: Cadena que representa la vulnerabilidad
        """
        return f"{self.vuln_id} - {self.name} (Severity: {self.severity})"
